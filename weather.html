<!DOCTYPE html>
<html lang="zh-cn">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme-color" content="#20C1FF">
  <title>é½å–œçš„ç½‘ç«™--å¤©æ°”çæŠ¥</title>
  <link rel="stylesheet" href="style.css">
  <style>
	.city { margin: 10px 0; }
	.temp { color: #e74c3c; font-weight: bold; }        /* æ¸©åº¦ - çº¢ */
	.feel { color: #e67e22; }                            /* ä½“æ„Ÿ - æ©™ */
	.humid { color: #3498db; }                           /* æ¹¿åº¦ - è“ */
	.wind { color: #2ecc71; }                            /* é£é€Ÿ - ç»¿ */
	.cloud { color: #95a5b6; }                           /* äº‘é‡ - ç°è“ */
	.uv { color: #f39c12; }                              /* UV - æ©™é»„ */
	.sun { color: #f1c40f; }                             /* æ—¥å‡ºæ—¥è½ - é‡‘ */
.refresh {
  position: fixed;
  top: 10px;
  right: 10px;
  font-size: 24px;
  cursor: pointer;
  user-select: none;
  z-index: 100;
  opacity: 0.7;
  transition: opacity 0.2s, transform 0.1s;
}

.refresh:hover {
  opacity: 1;
  transform: scale(1.1);
}

.refresh.error {
  color: #ff6b6b;
}

.forecast-row {
  margin-top: 8px;
  font-size: 14px;
  color: #555;
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.forecast-day {
  background: #f0f8ff;
  border: 1px solid #cce4ff;
  border-radius: 6px;
  padding: 4px 6px;
  white-space: nowrap;
}
  </style>
 </head>
 <!-- é¡µé¢å¤´éƒ¨ -->
 <body>
  <header style="position: relative;">
   <h1>é½å–œçš„ç½‘ç«™</h1>
   <h6>ç»ˆäºè¿›æ¥äº†ï¼Œéšä¾¿çœ‹çœ‹</h6>
   <!-- æ±‰å ¡èœå•æŒ‰é’® + ä¸‹æ‹‰ -->
   <div class="nav-menu-toggle">
	<div class="hamburger" onclick="this.classList.toggle('active')">
	 <span></span> <span></span> <span></span>
	</div>
	<ul class="nav-dropdown">
	 <li><a href="index.html"><strong>é¦–é¡µ</strong></a></li>
	 <li><a href="product.html"><strong>äº§å“ä¸­å¿ƒ</strong></a></li>
	 <li><a href="https://nailscrubber.github.io/hengdian.html"><strong>æ’ç”µè™šæ‹Ÿå…¬å¸</strong></a></li>
	 <li><a href="code.html"><strong>å…‘æ¢ç </strong></a></li>
	 <li><a href="weather.html"> åˆ·æ–°ï¼ˆå¤©æ°”çæŠ¥ï¼‰</a></li>
	 <li><a href="#weather_main"><small>å¤©æ°”çæŠ¥</small></a></li>
	 <li><a href="#weather_form"><small>å¯¹ç…§è¡¨</small></a></li>
	 <li><a href="about.html"><strong>å…³äºæˆ‘</strong></a></li>
	 <li><a href="https://www.123865.com/s/uxYEvd-eWWsH"><strong>ä¸‹è½½è½¯ä»¶</strong></a></li>
	</ul>
   </div>
  </header>
  <main class="container">
   <h2 id="weather_main">ğŸ˜†å¤©æ°”çæŠ¥</h2>
<div class="city" id="lemon"><strong>Lemonå¸‚ï¼š</strong>åŠ è½½ä¸­â€¦</div>
<div class="city" id="nb"><strong>NBæ€»éƒ¨ï¼š</strong>åŠ è½½ä¸­â€¦</div>
<div class="city" id="ptc"><strong>PTCå¸‚ï¼š</strong>åŠ è½½ä¸­â€¦</div>
<div class="city" id="hengdian"><strong>æ’ç”µåŒºï¼š</strong>åŠ è½½ä¸­â€¦</div>
<div class="city"><strong>Utwå¸‚</strong><br>âŒ æ•°æ®è·å–å¤±è´¥ï¼Œæ— æ³•è®¿é—®åæ ‡ã€‚</div>
   <p><br></p>
   <h2 id="weather_form">å¯¹ç…§è¡¨</h2>
   <p>æˆ‘ä»¬ä½¿ç”¨emojiæ¥è¡¨ç¤ºå¤©æ°”çŠ¶å†µã€‚å¦‚æ‚¨çš„è®¾å¤‡ä¸æ”¯æŒï¼Œè¯·å¿½ç•¥ã€‚</p>
   <p><strong>
   ğŸŒ = æ™´<br>
   ğŸŒ¤ = å°‘äº‘<br>
   ğŸŒ¥ = å¤šäº‘<br>
   â˜ = é˜´å¤©<br>
   ğŸŒ« = é›¾<br>
   ğŸ’§ = æ¯›æ¯›é›¨ / å°é›¨<br>
   ğŸ’¦ = å¤§æ¯›æ¯›é›¨<br>
   ğŸŒ§ = ä¸­é›¨ / ä¸­é˜µé›¨<br>
   ğŸŒ§ğŸŒ§ = å¤§é›¨ / å¤§é˜µé›¨<br>
   ğŸ§Š = å†»é›¨<br>
   ğŸŒ¨ = å°é›ª<br>
   â„ = é›ª / ä¸­é›ª<br>
   â„â„ = å¤§é›ª<br>
   ğŸŒ¦ = é˜µé›¨<br>
   ğŸŒ© = é›·é›¨/ é›·æš´<br>
   â›ˆï¸ = é›·æš´<br>
   â“ = ã€ä¸æ”¯æŒçš„å¤©æ°”ã€‘<br>
   NaN = ã€ä¸æ”¯æŒçš„æ•°æ®ã€‘
   </strong><br>
   æˆ‘ä»¬æš‚ä¸æ”¯æŒğŸŒªğŸŒ¬ğŸŒ€ğŸŒˆğŸ”¥ğŸŒŠç­‰ã€‚
   </p>
  </main>
  <script>
const advicePools = {
  cold: [],
  hot: [],
  rain: []
};
function pick(arr) { return arr[Math.floor(Math.random() * arr.length)] || ""; }

function weatherCodeToEmoji(code) {
  // æ™´ & äº‘
  if (code === 0) return "ğŸŒ";       // æ™´
  if (code === 1) return "ğŸŒ¤ï¸";       // å°‘äº‘
  if (code === 2) return "â›…";        // äº‘
  if (code === 3) return "â˜ï¸";        // é˜´å¤©

  // é›¾ & æ²™å°˜
  if (code >= 45 && code <= 48) return "ğŸŒ«ï¸"; // é›¾

  // é™æ°´ï¼ˆæŒ‰å¼ºåº¦åŒºåˆ†ï¼‰
  if (code >= 51 && code <= 53) return "ğŸ’§"; // å°æ¯›æ¯›é›¨
  if (code >= 55 && code <= 57) return "ğŸ’¦"; // ä¸­åˆ°å¤§æ¯›æ¯›é›¨

  if (code === 61) return "ğŸ’§";      // å°é›¨
  if (code === 63) return "ğŸŒ§ï¸";      // ä¸­é›¨
  if (code === 65) return "ğŸŒ§ğŸŒ§";      // å¤§é›¨
  if (code >= 66 && code <= 67) return "ğŸ§Š"; // å†»é›¨ï¼ˆç”¨å†°æ™¶è¡¨ç¤ºï¼‰

  // é›ª
  if (code === 71) return "ğŸŒ¨ï¸";      // å°é›ª
  if (code === 73) return "â„ï¸";      // ä¸­é›ª
  if (code >= 75 && code <= 77) return "â„â„"; // å¤§é›ª

  // é˜µæ€§é™æ°´
  if (code === 80) return "ğŸŒ¦ï¸";      // å°é˜µé›¨
  if (code === 81) return "ğŸŒ§ï¸";      // ä¸­é˜µé›¨
  if (code === 82) return "ğŸŒ§ğŸŒ§";      // å¼ºé˜µé›¨

  // é›·æš´
  if (code === 95) return "ğŸŒ©";      // é›·æš´ï¼ˆè½»ï¼‰
  if (code === 96) return "â›ˆï¸";      // é›·æš´

  else return "â“"; // ç©¶æå¤©æ°”

  // é»˜è®¤
  return "ğŸŒ›"; //å¤œç©º
}

function formatTime(unix) {
  const d = new Date(unix * 1000);
  return d.getHours().toString().padStart(2, '0') + ':' + d.getMinutes().toString().padStart(2, '0');
}

const cities = [
  ["Lemonå¸‚", 46.643, 124.849, "lemon"],
  ["NBæ€»éƒ¨", 39.9042, 116.4074, "nb"],
  ["PTCå¸‚", 28.0000, 120.6994, "ptc"],
  ["æ’ç”µåŒº", 27.7333, 111.6500, "hengdian"],
];

/************* 5 æ—¥å¤©æ°”å°æ¨ªæ¡æ ·å¼ *************/
const forecastCSS = document.createElement('style');
forecastCSS.textContent = `
  .forecast-row { margin-top:8px;font-size:13px;color:#555; }
  .forecast-day { display:inline-block;margin:2px 4px 2px 0;padding:3px 6px;background:#f0f8ff;border:1px solid #cce4ff;border-radius:5px;white-space:nowrap; }
`;
document.head.appendChild(forecastCSS);
/********************************************/

cities.forEach(([name, lat, lon, id]) => {
  /* ---- å…ˆæ‹¿ä»Šå¤©è¯¦æƒ… ---- */
  const todayUrl = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,is_day,precipitation,rain,showers,snowfall,weather_code,cloud_cover,wind_speed_10m,wind_direction_10m,uv_index,visibility&hourly=relative_humidity_2m,apparent_temperature&daily=sunrise,sunset,uv_index_max&timezone=Asia/Shanghai&forecast_days=1`;

  fetch(todayUrl)
	.then(r => r.json())
	.then(data => {
	  const cur = data.current;
	  const hourly = data.hourly;
	  const daily = data.daily;
	  const h = new Date().getHours();

	  const temp = cur.temperature_2m?.toFixed(1) ?? '?';
	  const feels = (hourly.apparent_temperature?.[h] ?? cur.apparent_temperature)?.toFixed(1) ?? temp;
	  const hum = (hourly.relative_humidity_2m?.[h] ?? cur.relative_humidity_2m)?.toFixed(0) ?? '?';
	  const wind = cur.wind_speed_10m?.toFixed(1) ?? '?';
	  const windDir = cur.wind_direction_10m ? Math.round(cur.wind_direction_10m) + 'Â°' : '?';
	  const cloud = cur.cloud_cover?.toFixed(0) ?? '?';
	  const uv = cur.uv_index?.toFixed(1) ?? '?';
	  const sunrise = formatTime(daily.sunrise[0]);
	  const sunset = formatTime(daily.sunset[0]);
	  const emoji = weatherCodeToEmoji(cur.weather_code);

	  let extra = '';
	  const tNum = parseFloat(temp);
	  const hasRain = (parseFloat(cur.rain || 0) > 0.1) || (parseFloat(cur.showers || 0) > 0.1);
	  if (!isNaN(tNum)) {
		if (tNum < 0) extra = pick(advicePools.cold);
		else if (tNum > 32) extra = pick(advicePools.hot);
		else if (hasRain) extra = pick(advicePools.rain);
	  }

	  document.getElementById(id).innerHTML = `
		<strong>${name}</strong> ${emoji} <br>
		<span class="temp">${temp}â„ƒ</span>ï¼ˆä½“æ„Ÿ<span class="feel">${feels}â„ƒ</span>ï¼‰<br>
		| æ¹¿åº¦<span class="humid">${hum}%</span><br>
		| é£é€Ÿ<span class="wind">${wind}m/s</span>ï¼ˆé£å‘å¤§çº¦${windDir}ï¼‰<br>
		| äº‘é‡<span class="cloud">${cloud}%</span><br>
		| UV<span class="uv">${uv}</span><br>
		| æ—¥å‡º<span class="sun">${sunrise}</span> æ—¥è½<span class="sun">${sunset}</span><br><strong>5æ—¥å¤©æ°”çæŠ¥ï¼š</strong><br>
		${extra ? `<span class="extra">${extra}</span>` : ''}
	  `.replace(/\s+/g, ' ').trim();

	  /* ---- å†æ‹¿ 5 æ—¥é¢„æŠ¥ ---- */
	  return fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=temperature_2m_max,temperature_2m_min,weather_code&timezone=Asia/Shanghai&forecast_days=5`);
	})
	.then(r => r.json())
	.then(data => {
	  const max = data.daily.temperature_2m_max;
	  const min = data.daily.temperature_2m_min;
	  const codes = data.daily.weather_code;
	  let row = '<div class="forecast-row">';
	  for (let i = 0; i < 5; i++) {
		row += `<span class="forecast-day">${weatherCodeToEmoji(codes[i])} ${max[i].toFixed(0)}Â°/${min[i].toFixed(0)}Â°</span>`;
	  }
	  row += '</div>';
	  document.getElementById(id).insertAdjacentHTML('afterend', row);
	})
	.catch(() => {
	  document.getElementById(id).innerHTML = `<strong>${name}</strong> âŒ æ•°æ®è·å–å¤±è´¥ï¼ˆä¿¡å·å¡”è¢«Utwç‚¸äº†ï¼‰`;
	});
});
</script>

  <!-- é¡µè„š -->
  <footer>
   <p><a href="https://space.bilibili.com/345281727">@é½å–œçš„é¢‘é“</a> 2024-2025 ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚</p>
   <p><small>å¤©æ°”æ•°æ®æ¥æºäº <a href="https://open-meteo.com/" target="_blank" rel="noopener noreferrer">Open-Meteo</a>ï¼Œä»…ä¾›å¨±ä¹ã€‚</small></p>
   <p><small> ç‰ˆæœ¬ v.0.2.15 </small></p>
  </footer>
 </body>
</html>